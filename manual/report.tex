\documentclass[11pt,a4paper]{article}
% \usepackage[brazil]{babel} % carrega portugues brasileiro
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[top=2cm, bottom=2cm, left=2cm, right=2cm]{geometry} %margens menores!
\usepackage{graphicx} % incluir figuras .eps
\usepackage{tabularx}
\usepackage{color} % colorir texto
\usepackage{indentfirst}
\usepackage{textcomp}
\usepackage[colorlinks=true]{hyperref}
\usepackage{amssymb,amsmath}
\usepackage{float}
% \usepackage{siunitx}
% \usepackage[ampersand]{easylist}

\title{Manual de uso do sistema de telecomunicação digital para banda de HF}

\author{
       \large
        \textsc{Rafael Diniz}
        \mbox{}\\ %
        rafael@rhizomatica.org\\
        \mbox{Rhizomatica} \\ %
        \normalsize
        \texttt{Brasília - Brasil}\\
}
\date{\today}


\begin{document}

\maketitle

\begin{abstract}
Este é o manual do sistema de comunicação digital em HF usando o modem ARDOP
(Amateur Radio Digital Open Protocol) e o sistema UUCP (Unix to Unix
Communication Protocol). O manual também abrange a interface gráfica
para usuário baseada em tecnologia Web, assim como os serviços e principais
configurações do sistema de referência baseado na raspberry pi.

\end{abstract}

\newpage

\tableofcontents

\section{Sistema de referência}

Um rádio com porta USB como o ICOM IC-7100 ou o ICOM IC-7300, ou opcionalmente o ICOM IC-78, ICOM IC-718 ou Vertex
VX-1700 com a interface Signalink USB, conectado a uma Raspberry Pi 3
rodando Linux.

\section{Configuração}

O ARDOP é um modem SDR feito por rádio amadores que utiliza modernas
técnicas de modulação (OFDM) e UUCP é uma sistema para comunicação
assíncrona da década de 70 para sistemas UNIX, muito utilizado até
hoje em nichos, como comunicação em HF.

Debian Buster (10) arm64 (multilib com armhf no caso se querer usar os
binários ``piardopc'' do John Wiseman) é o sistema Linux de referência,
rodando numa Raspberry Pi 3 com Wifi configurado no modo AP (Access Point),
para provimento de interface do sistema via Web.

Para integrar o sistema UUCP ao modem ARDOP, o projeto RHIZO-UUARDOPD
foi desenvolvido para prover ferramentas que integram o UUCP ao ARDOP.

\subsection{Radio e/ou interface}

No caso de uso da interface Signalink, o ajuste de ``delay'' deve ser
zerado.

No caso dos ICOM IC-7100, deixar o filtro maior que 2.8kHz para o mode
SSB/Data em uso com o sistema digital.

\subsection{ARDOP}

Link para download: \url{http://www.cantab.net/users/john.wiseman/Downloads/Test/TeensyProjects.zip}

O binário utilizado do ardop deve ficar em /usr/bin/ardop, que pode ser um
link simbólico para /usr/bin/{ardop1ofdm, ardop2, ardopofdm}, pro exemplo.

Configuração do ardop para uso com o ICOM IC-7100 (via porta USB, com PTT
via porta serial):
\begin{verbatim}
[Unit]
Description=ARDOP daemon

[Service]
Type=simple
ExecStart=/usr/bin/ardop 8515 -c /dev/ttyUSB0 ARDOP ARDOP -k FEFE88E01C0001FD -u FEFE88E01C0000FD
ExecStop=/usr/bin/killall -s QUIT ardop
IgnoreSIGPIPE=no
#StandardOutput=null
#StandardError=null
StandardOutput=syslog
StandardError=syslog

[Install]
WantedBy=multi-user.target
\end{verbatim}

Configuração para uso com a interface Signalink (VOX):
\begin{verbatim}
[Unit]
Description=ARDOP daemon

[Service]
Type=simple
ExecStart=/usr/bin/ardop 8515 ARDOP ARDOP
ExecStop=/usr/bin/killall -s QUIT ardop
IgnoreSIGPIPE=no
#StandardOutput=null
#StandardError=null
StandardOutput=syslog
StandardError=syslog

[Install]
WantedBy=multi-user.target
\end{verbatim}


Iniciar / Parar serviço:
\begin{verbatim}
systemctl start ardop.service
systemctl stop ardop.service
\end{verbatim}


Ver log:
\begin{verbatim}
journalctl -f -u ardop
\end{verbatim}

\subsection{UUCP}

Usar versão do pacote do debian 1.07-27 ou superior, por exemplo, a versão
do Debian Bullseye: \url{https://packages.debian.org/bullseye/uucp}.

ps: baixar o .deb e instalar na mão.

\subsection{rhizo-uuardopd}

TODO: It seems everything uucico wrote in the end of a reception, don't get
to the other side - connection closes and buffer get clean fast!

Dois binários, uuport (para ser usado pelo uucp) e uuardopd que é o software
que conecta com o modem Ardop através do uucico ou uuport.

\url{http://github.com/DigitalHERMES/rhizo-uuardop}


Iniciar / Parar serviço:
\begin{verbatim}
systemctl start uuardopd.service
systemctl stop uuardopd.service
\end{verbatim}


Ver log:
\begin{verbatim}
journalctl -f -u uuardopd
\end{verbatim}

\subsection{DHCP}

\subsection{DNS}

\subsection{Apache + PHP}

\section{Interface via UUCP em linha de comando}

O diretório para arquivos recebidos ``/var/www/html/arquivos''.

Adicionando a fila de envio (``-r'' não inicia a transmissão de forma
automática):
\begin{verbatim}
uucp -C -r -d source.xxx AM4AAB\!/var/www/html/arquivos/${nodename}/
\end{verbatim}

Para disparar o envio de todos os jobs para o destinatário
AM4AAA:
\begin{verbatim}
uucico -S AM4AAA
\end{verbatim}

Para lista os jobs:
\begin{verbatim}
uustat -a
\end{verbatim}

Para matar jobs:
\begin{verbatim}
uustat -k job
uustat -K
\end{verbatim}

Ver log:
\begin{verbatim}
uulog
\end{verbatim}

\section{Interface com o usuário}

A interface do sistema é baseada em Web, utilizando HTML+PHP e
alguns shell scripts.

\section{Pré-requisitos}

\begin{itemize}
\item ImageMagic: para descomprimir imagens
\item mozjpeg: para comprimir em jpg: https://github.com/mozilla/mozjpeg
% \item opusenc: para comprimir áudio
\item gpg: para criptografia
\item hostapd: para o roteador wifi (com senha ou sem senha)
\end{itemize}

\subsection{Interface Web}

Acessível digitando qualquer endereço no navegador, ou 192.168.1.1.

\subsection{WebPhone}

\url{https://gitlab.tic-ac.org/keith/webphone/wikis/hermes}

\end{document}
